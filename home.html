<template>
  <div
      v-for="(node, index) in slave_nodes"
      :key="index"
  >
    <div>
        <p>Node ID : {{ node.node_id }}</p>
        <p>MAC Addr : {{ node.mac_address }}</p>
        <p>Node Type : {{ node.node_type }}</p>
        <p>Description : {{ node.description }}</p>
    </div>
  </div>

</template>
<script>
export default {
  mounted() {
    if (localStorage.getItem("loggedIn") === "false") {
        this.redirectLogin();
    }
    
    // get data from mongoDB at first
    this.getNodesMongoDB();
  },
  data() {
    return {
      slave_nodes: [],
      getNode_request: false, 
    };
  },
  watch: {
    msg(newMsg) {
      // handle MongoDB

      // handle getNodes
      if (newMsg.type == "MONGO_DB" && this.getNode_request) {
        this.slave_nodes = newMsg.payload;
        this.getNode_request = false;
      }
    }
  },
  methods: {
    redirectLogin() {
      const base = window.location.origin;
      window.location.href = `${base}/dashboard/login`;
    },
    getNodesMongoDB() {
      const sendObj = {
        collection: "nodes",
        operation: "find.toArray",
        type: "MONGO_DB"
      };
      this.getNode_request = true, 
      this.send(sendObj);
    }
  }
};
</script>

<!-- 

- pull data slave nodes from mongoDB show on screen
- master status label
- sync button for sync slave database with mesh slave
- get active node and match to node in database to tell which node is online [ master online condition ] on open webpage
- refresh button to get active node again
- naming system and update to database
- config relay slave 
- config type of sensor (button, toggle, relay)
-->